# WhatsApp API Home Assistant Add-on Configuration
# https://github.com/bakeable/homeassistant-whatsapp-add-on

name: WhatsApp Gateway
version: "1.0.0"
slug: whatsapp_gateway
description: >-
  Send and receive WhatsApp messages from Home Assistant. Provides a notify
  service, automation triggers, and a web UI for managing your WhatsApp connection.
url: https://github.com/bakeable/homeassistant-whatsapp-add-on

# Supported architectures
arch:
  - aarch64
  - amd64
  - armv7

# Minimum Home Assistant version
homeassistant: "2024.1.0"

# Add-on behavior
startup: services
boot: auto
init: false

# Network configuration
# The gateway UI (ingress) runs on port 8099
ingress: true
ingress_port: 8099
panel_icon: mdi:whatsapp
panel_title: WhatsApp

# Exposed ports
ports:
  8080/tcp: null
  8099/tcp: null
ports_description:
  8080/tcp: Evolution API REST API (internal)
  8099/tcp: WhatsApp Gateway UI

# Storage mappings - persistent data for sessions
map:
  - addon_config:rw

# User-configurable options
options:
  api_key: ""
  instance_name: "HomeAssistant"
  webhook_url: ""
  log_level: "INFO"
  database_provider: "mysql"
  database_host: "core-mariadb"
  database_port: 3306
  database_name: "evolution"
  database_user: "evolution"
  database_password: ""
  redis_uri: ""
  # Instance settings
  sync_full_history: true
  reject_calls: false
  groups_ignore: false
  always_online: false
  read_messages: false
  read_status: false
  # Gateway settings
  allowed_services: "script.turn_on,automation.trigger"

# Schema for options validation
schema:
  api_key: str?
  instance_name: str
  webhook_url: url?
  log_level: list(DEBUG|INFO|WARN|ERROR)
  database_provider: list(mysql|postgresql)
  database_host: str
  database_port: int
  database_name: str
  database_user: str
  database_password: password
  redis_uri: str?
  # Instance settings
  sync_full_history: bool
  reject_calls: bool
  groups_ignore: bool
  always_online: bool
  read_messages: bool
  read_status: bool
  # Gateway settings
  allowed_services: str

# Watchdog for auto-restart on failure
watchdog: http://[HOST]:[PORT:8099]/api/health

# API access
homeassistant_api: true
hassio_api: true
auth_api: true

# Discovery - advertise notify service to Home Assistant
discovery:
  - whatsapp

# Services provided
services:
  - mqtt:want
